<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô 365 ‡∏ß‡∏±‡∏ô (Pro)</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --danger-color: #e53935;
            --blue-color: #2196F3;
            --orange-color: #FF9800;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { color: var(--primary-color); margin-bottom: 5px; text-align: center; }
        .subtitle { text-align: center; color: #666; margin-bottom: 20px; font-size: 0.9rem; }

        .dashboard {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
            text-align: center;
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        .stats { display: flex; justify-content: space-around; margin-bottom: 15px; font-size: 1.1rem; }
        .stat-box strong { display: block; font-size: 1.4rem; color: var(--primary-color); }

        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 25px;
            height: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .data-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-backup { background-color: var(--blue-color); }
        .btn-restore { background-color: var(--orange-color); }
        .btn-reset { background-color: #607d8b; }
        .btn:hover { opacity: 0.9; }

        /* Grid Layout */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px;
            width: 100%;
            max-width: 800px;
        }

        .day-box {
            background: var(--card-bg);
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 50px;
        }

        .day-box:active { transform: scale(0.95); }
        .day-box.active { background-color: #e8f5e9; border-color: var(--primary-color); }
        
        .day-box .amount { font-weight: bold; font-size: 1.1rem; }
        .day-box .day-number { font-size: 0.75rem; color: #888; margin-bottom: 2px; }

        .counter-badge {
            position: absolute; top: -8px; right: -8px;
            background-color: var(--primary-color); color: white;
            font-size: 0.75rem; font-weight: bold;
            width: 22px; height: 22px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transform: scale(0); transition: all 0.2s;
        }
        .day-box.active .counter-badge { opacity: 1; transform: scale(1); }

        .minus-btn {
            position: absolute; bottom: -5px; right: -5px;
            background-color: var(--danger-color); color: white;
            width: 20px; height: 20px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; line-height: 0; cursor: pointer;
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .day-box.active .minus-btn { opacity: 1; pointer-events: auto; }

        /* ‡∏ã‡πà‡∏≠‡∏ô input file */
        #file-input { display: none; }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <h1>üí∞ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô 365 ‡∏ß‡∏±‡∏ô</h1>
    <div class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ + ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ</div>
    
    <div class="dashboard">
        <div class="stats">
            <div class="stat-box">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß <strong id="total-saved">0</strong> ‡∏ö‡∏≤‡∏ó</div>
            <div class="stat-box">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ <strong>66,795</strong> ‡∏ö‡∏≤‡∏ó</div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <p id="progress-text" style="margin-top: 10px; font-size: 0.9rem;">0% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
    </div>

    <div class="data-controls">
        <button class="btn btn-backup" onclick="exportData()">‚¨áÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå (Backup)</button>
        <button class="btn btn-restore" onclick="document.getElementById('file-input').click()">‚¨ÜÔ∏è ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏ü‡∏•‡πå</button>
        <button class="btn btn-reset" onclick="resetData()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <input type="file" id="file-input" accept=".json" onchange="importData(this)">
    </div>

    <div class="grid-container" id="grid"></div>

    <script>
        const totalDays = 365;
        const gridContainer = document.getElementById('grid');
        const totalSavedEl = document.getElementById('total-saved');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        
        let savedData = JSON.parse(localStorage.getItem('savedDataMulti')) || {};

        function initGrid() {
            gridContainer.innerHTML = '';
            for (let i = 1; i <= totalDays; i++) {
                const count = savedData[i] || 0;
                const box = document.createElement('div');
                box.className = `day-box ${count > 0 ? 'active' : ''}`;
                box.id = `day-${i}`;
                box.innerHTML = `
                    <div class="counter-badge" id="badge-${i}">x${count}</div>
                    <span class="day-number">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${i}</span>
                    <div class="amount">${i}</div>
                    <div class="minus-btn" onclick="decreaseDay(${i}, event)">-</div>
                `;
                box.onclick = (e) => {
                    if(e.target.classList.contains('minus-btn')) return;
                    increaseDay(i);
                };
                gridContainer.appendChild(box);
            }
            calculateTotal();
        }

        function increaseDay(day) {
            if (!savedData[day]) savedData[day] = 0;
            savedData[day]++;
            updateBoxVisual(day);
            saveAndCalculate();
        }

        function decreaseDay(day, event) {
            if(event) event.stopPropagation();
            if (savedData[day] && savedData[day] > 0) {
                savedData[day]--;
                if (savedData[day] === 0) delete savedData[day];
            }
            updateBoxVisual(day);
            saveAndCalculate();
        }

        function updateBoxVisual(day) {
            const count = savedData[day] || 0;
            const box = document.getElementById(`day-${day}`);
            const badge = document.getElementById(`badge-${day}`);
            if (count > 0) {
                box.classList.add('active');
                badge.innerText = `x${count}`;
            } else {
                box.classList.remove('active');
            }
        }

        function saveAndCalculate() {
            localStorage.setItem('savedDataMulti', JSON.stringify(savedData));
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            for (const [day, count] of Object.entries(savedData)) {
                total += parseInt(day) * count;
            }
            const target = 66795;
            const percentage = (total / target) * 100;

            totalSavedEl.innerText = total.toLocaleString();
            progressBar.style.width = (percentage > 100 ? 100 : percentage) + '%';
            
            if (percentage >= 100) progressBar.style.backgroundColor = '#FFD700';
            else progressBar.style.backgroundColor = '#4CAF50';

            if (total < target) progressText.innerText = `${percentage.toFixed(2)}% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`;
            else progressText.innerText = `üéâ ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ${(total - target).toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå (Export/Import) ---

        function exportData() {
            if (Object.keys(savedData).length === 0) {
                alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡∏ö");
                return;
            }
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå JSON
            const dataStr = JSON.stringify(savedData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            const date = new Date();
            const fileName = `saving_backup_${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', fileName);
            linkElement.click();
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const contents = e.target.result;
                    const newData = JSON.parse(contents);
                    
                    if(confirm("‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏à‡∏∞‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                        savedData = newData;
                        saveAndCalculate(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage
                        initGrid(); // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                        alert("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                    }
                } catch (err) {
                    alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
                }
                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                input.value = ''; 
            };
            reader.readAsText(file);
        }

        function resetData() {
            if(confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                localStorage.removeItem('savedDataMulti');
                savedData = {};
                initGrid();
            }
        }

        initGrid();
    </script>

</body>
</html>